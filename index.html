<!DOCTYPE html>
<!--
© 2025 Alessandro Pezzali. Tutti i diritti riservati.
Licenza d’Uso — Il Cubo di Rubik PWA
-->
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,height=device-height,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0" />
  <meta name="author" content="Alessandro Pezzali" />
  <meta name="description" content="Il Cubo di Rubik" />
  <title>Il Cubo di Rubik</title>

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Il Cubo di Rubik" />
  <meta property="og:title" content="Il Cubo di Rubik" />
  <meta property="og:description" content="Gioca e risolvi il cubo!" />
  <meta property="og:image" content="icons/meta-image.png" />
  <meta property="og:url" content="https://www.alessandropezzali.it/KubeApp/" />

  <!-- PWA / iOS -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Il Cubo" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#ffffff" />

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png" />
  <link rel="shortcut icon" href="icons/favicon.ico" />

  <!-- CSS -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Stili minimi per il pannello Aiuto (così non tocchi styles.css) -->
  <style>
    .help[hidden]{display:none!important}
    .help{position:fixed;inset:0;z-index:9999;font-family:inherit}
    .help__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px)}
    .help__card{position:relative;max-width:720px;margin:4rem auto;background:#fff;color:#111;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.2);padding:1.25rem 1.5rem}
    .help__card h2{margin:0 0 .5rem;font-size:1.4rem}
    .help__card h3{margin:1rem 0 .25rem;font-size:1.1rem}
    .help__card code{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;background:#f3f3f3;padding:.1rem .35rem;border-radius:6px}
    .help__card ul,.help__card ol{margin:.35rem 0 .75rem 1.25rem}
    .help__close{position:absolute;top:.5rem;right:.6rem;width:2rem;height:2rem;border:0;background:transparent;color:#444;font-size:1.5rem;line-height:1;cursor:pointer}
    .help__close:hover{color:#000}
    .btn--help{pointer-events:all;font-weight:700;width:2.2em;height:2.2em;border-radius:50%;background:rgba(255,255,255,.9);box-shadow:0 3px 10px rgba(0,0,0,.1)}
  </style>

  <script>
    // bump per forzare l'invalidation della cache offline
    window.gameVersion = '0.0.1'; // prima versione di test su Windows e MacOs
  </script>
</head>
<body>

  <noscript>
    <p style="padding:12px;background:#ffeded;color:#900;font-family:system-ui,Arial">
      Attiva JavaScript per giocare al Cubo di Rubik.
    </p>
  </noscript>

  <div class="ui" aria-live="polite">
    <div class="ui__background"></div>
    <div class="ui__game" aria-label="Area di gioco 3D"></div>

    <div class="ui__texts">
      <h1 class="text text--title">
        <span>IL</span>
        <span>CUBO</span>
      </h1>
      <div class="text text--note">Doppio click e parti!!!</div>
      <div class="text text--timer">0:00</div>
      <div class="text text--complete"><span>Completato!</span></div>
      <div class="text text--best-time">
        <icon trophy></icon>
        <span>Miglior tempo!</span>
      </div>
    </div>

    <div class="ui__prefs">
      <range name="size" title="Dimensione Cubo" list="2,3,4,5"></range>
      <range name="flip" title="Tipo di Rotazione" list="Rapido,Morbido,Rimbalzo"></range>
      <range name="scramble" title="Lunghezza Mischia" list="20,25,30"></range>
      <range name="fov" title="Angolo Camera" list="Ortografica,Prospettica"></range>
      <range name="theme" title="Schema Colori" list="Classico,Erno,Polvere,Camo,Pioggia"></range>
    </div>

    <div class="ui__theme">
      <range name="hue" title="Tonalità" color></range>
      <range name="saturation" title="Saturazione" color></range>
      <range name="lightness" title="Luminosità" color></range>
    </div>

    <div class="ui__stats">
      <div class="stats" name="cube-size"><i>Cubo:</i><b>3x3x3</b></div>
      <div class="stats" name="total-solves"><i>Soluzioni totali:</i><b>-</b></div>
      <div class="stats" name="best-time"><i>Miglior tempo:</i><b>-</b></div>
      <div class="stats" name="worst-time"><i>Peggior tempo:</i><b>-</b></div>
      <div class="stats" name="average-5"><i>Media di 5:</i><b>-</b></div>
      <div class="stats" name="average-12"><i>Media di 12:</i><b>-</b></div>
      <div class="stats" name="average-25"><i>Media di 25:</i><b>-</b></div>
    </div>

    <div class="ui__buttons">
      <button class="btn btn--tl btn--help" aria-label="Aiuto">?</button>
      <button class="btn btn--bl btn--stats" aria-label="Statistiche"><icon trophy></icon></button>
      <button class="btn btn--br btn--prefs" aria-label="Preferenze"><icon settings></icon></button>
      <button class="btn btn--bl btn--back" aria-label="Indietro"><icon back></icon></button>
      <button class="btn btn--br btn--theme" aria-label="Modifica tema"><icon theme></icon></button>
      <button class="btn btn--br btn--reset" aria-label="Reimposta tema"><icon reset></icon></button>
    </div>
  </div>

  <!-- Help / Guida -->
  <div class="help" id="help" hidden>
    <div class="help__backdrop" data-help-close></div>
    <div class="help__card" role="dialog" aria-labelledby="help-title" aria-modal="true">
      <button class="help__close" data-help-close aria-label="Chiudi">×</button>
      <h2 id="help-title">Come risolvere il Cubo di Rubik (Metodo Principianti)</h2>

      <p>Guida rapida per completare un 3×3×3 con il metodo a strati.</p>

      <h3>Notazione essenziale</h3>
      <ul>
        <li><b>U D L R F B</b> = Up, Down, Left, Right, Front, Back (90° orario).</li>
        <li><b>'</b> = antiorario (es. U'), <b>2</b> = 180° (es. U2).</li>
      </ul>

      <h3>Passi</h3>
      <ol>
        <li><b>Croce bianca</b> sul lato bianco, allineando i bordi ai centri laterali.</li>
        <li><b>Angoli bianchi</b> (1° strato). Sequenza utile: <code>R U R'</code> ripetuta.</li>
        <li><b>Secondo strato</b> (inserisci i bordi senza giallo):
          <ul>
            <li>Destra: <code>U R U' R' U' F' U F</code></li>
            <li>Sinistra: <code>U' L' U L U F U' F'</code></li>
          </ul>
        </li>
        <li><b>Croce gialla</b> in alto: <code>F R U R' U' F'</code> finché ottieni la croce.</li>
        <li><b>Allinea i bordi gialli</b> ai centri: <code>R U R' U R U2 R'</code>.</li>
        <li><b>Posiziona gli angoli gialli</b> (non importa l’orientamento):
          <br><code>U R U' L' U R' U' L</code> finché sono al posto giusto.</li>
        <li><b>Orientamento angoli gialli</b>:
          <br>Con l’angolo da orientare in alto-fronte-destra, ripeti <code>R U R' U'</code> finché è corretto, ruota U e ripeti.</li>
      </ol>

      <p style="margin-top:1em;font-size:.9em;opacity:.75">
        Nota: sintesi didattica per uso personale.
      </p>
    </div>
  </div>

  <!-- JS: bundle unico -->
  <script src="three.js"></script>
  <script src="cube.js"></script>

  <!-- Offline (UpUp) -->
  <script src="upup.min.js"></script>
  <script>
    // UpUp richiede HTTPS
    if (location.protocol === 'https:' && typeof UpUp !== 'undefined' && UpUp) {
      UpUp.start({
        'cache-version': window.gameVersion,
        'content-url': 'index.html',
        'assets': [
          'styles.css',
          'three.js',
          'cube.js',
          'icons/favicon-32x32.png',
          'icons/favicon-16x16.png',
          'icons/apple-touch-icon.png',
          'icons/meta-image.png'
        ]
      });
    }

    // Toggle Help
    (function () {
      const help = document.getElementById('help');
      const btn = document.querySelector('.btn--help');
      const closeEls = document.querySelectorAll('[data-help-close]');

      if (btn && help) {
        btn.addEventListener('click', () => {
          help.hidden = false;
          document.body.style.overflow = 'hidden';
        });
        closeEls.forEach(el => el.addEventListener('click', () => {
          help.hidden = true;
          document.body.style.overflow = '';
        }));
        document.addEventListener('keydown', (e) => {
          if (!help.hidden && e.key === 'Escape') {
            help.hidden = true;
            document.body.style.overflow = '';
          }
        });
      }
    })();
  </script>
</body>
</html>
